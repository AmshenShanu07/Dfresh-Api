generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String     @id @default(cuid())
  name          String
  phone         String     @unique
  password      String
  userType      UserTypes  @default(CUSTOMER)
  email         String?    @default("")
  createdAt     DateTime   @default(now())
  address       String?    @default("")
  Purchase      Purchase[]
  OutletAgent   Staff[]
  UserAddress   UserAddress[]
  OrderDetails  OrderDetails[]
}

model UserAddress {
  id        String     @id @default(cuid())
  userId    String
  name      String     @default("")
  address   String     @default("")
  pinCode   String     @default("")
  phone     String     @default("")
  createdAt DateTime   @default(now())
  user      User       @relation(fields: [userId], references: [id])
}

model Category {
  id          String     @id @default(cuid())
  name        String
  isActive    Boolean    @default(true)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  Products    Products[]
}

model Products {
  id                   String                 @id @default(cuid())
  name                 String
  description          String
  image                String[]
  categoryId           String
  catalogId            String                 @default("")
  isActive             Boolean                @default(true)
  isDeleted            Boolean                @default(false)
  createdAt            DateTime               @default(now())
  CatalogProducts      CatalogProducts[]
  category             Category               @relation(fields: [categoryId], references: [id])
  Purchase             Purchase[]
  ShareCatalogProducts ShareCatalogProducts[]
  Outlets              Outlets[]              @relation("OutletsToProducts")
  OrderItems           OrderItems[]
}

model Purchase {
  id                String        @id @default(cuid())
  productId         String
  outletId          String
  supplierId        String
  batchNumber       String
  quantity          Float
  quantityUnit      ProductUnits
  totalPrice        Float
  pricePerUnit      Float
  releasedQtny      Float?
  releasedQntyUnit  ProductUnits?
  cleanedQnty       Float?
  cleanedQntyUnit   ProductUnits?
  cleanedCount      Float?
  thresholdQnty     Float?
  thresholdQntyUnit ProductUnits?
  createdAt         DateTime      @default(now())
  outlet            Outlets       @relation(fields: [outletId], references: [id])
  product           Products      @relation(fields: [productId], references: [id])
  supplier          User          @relation(fields: [supplierId], references: [id])
}

model Catalog {
  id                   String                 @id @default(cuid())
  name                 String
  description          String
  isShared             Boolean                @default(false)
  isDeleted            Boolean                @default(false)
  isActive             Boolean                @default(true)
  publishedDate        DateTime?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  CatalogProducts      CatalogProducts[]
  ShareCatalog         ShareCatalog[]
  ShareCatalogProducts ShareCatalogProducts[] @relation("CatalogToShareCatalogProducts")
}

model CatalogProducts {
  id                 String   @id @default(cuid())
  catalogId          String
  productId          String
  productCatalogId   String     @default("")
  createdAt          DateTime   @default(now())
  catalog            Catalog    @relation(fields: [catalogId], references: [id])
  product            Products   @relation(fields: [productId], references: [id])
}

model ShareCatalog {
  id                   String                 @id @default(cuid())
  catalogId            String
  isDeleted            Boolean                @default(false)
  isActive             Boolean                @default(true)
  createdAt            DateTime               @default(now())
  publishDate          String
  publishTime          String
  catalog              Catalog                @relation(fields: [catalogId], references: [id])
  ShareCatalogProducts ShareCatalogProducts[]
}

model ShareCatalogProducts {
  id                  String       @id @default(cuid())
  shareCatalogId      String
  productCatalogId    String     @default("")
  productId           String
  qnty                Float
  qntyUnit            ProductUnits
  price               Float
  createdAt           DateTime     @default(now())
  product             Products     @relation(fields: [productId], references: [id])
  shareCatalog        ShareCatalog @relation(fields: [shareCatalogId], references: [id])
  Catalog             Catalog[]    @relation("CatalogToShareCatalogProducts")
}

model Outlets {
  id             String     @id @default(cuid())
  name           String?    @default("")
  address        String?    @default("")
  phone          String?    @default("")
  location       String
  isSalesEnabled Boolean    @default(false)
  createdAt      DateTime   @default(now())
  isDeleted      Boolean    @default(false)
  isActive       Boolean    @default(true)
  commission     Float
  Purchase       Purchase[]
  OutletAgent    Staff[]
  products       Products[] @relation("OutletsToProducts")
}

model Staff {
  id        String   @id @default(cuid())
  userId    String
  outletId  String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  outlet    Outlets  @relation(fields: [outletId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Supplier {
  id           String   @id @default(cuid())
  name         String
  supplierCode String
  phone        String?  @default("")
  email        String?  @default("")
  address      String?  @default("")
  createdAt    DateTime @default(now())
  isDeleted    Boolean  @default(false)
}

enum UserTypes {
  ADMIN
  CUSTOMER
  OUTLET_AGENT
  CENTRAL_STAFF
  PURCHASE_STAFF
  SUPPLIER
}

enum ProductUnits {
  KG
  G
}


model OrderDetails {
  id                String @id @default(cuid())
  userId            String
  totalAmount       Float
  status            OrderStatus @default(PENDING)
  deliveryDetails   DeliveryDetails? @relation("OrderToDelivery")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  orderItems        OrderItems[]
  user              User @relation(fields: [userId], references: [id])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  DISPATCHED
  DELIVERED
  CANCELLED
}

model OrderItems {
  id          String @id @default(cuid())
  orderId     String
  productId   String
  product     Products @relation(fields: [productId], references: [id])
  quantity    Float
  price       Float
  totalPrice  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  order       OrderDetails @relation(fields: [orderId], references: [id])
}

model DeliveryDetails {
  id            String @id @default(cuid())
  address       String
  phone         String
  pinCode       String
  name          String
  orderId       String  @unique
  order         OrderDetails @relation("OrderToDelivery", fields: [orderId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}